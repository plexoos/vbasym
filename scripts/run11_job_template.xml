<?xml version="1.0" encoding="utf-8" ?>
<job filesPerHour="60" maxFilesPerProcess="500" fileListSyntax="xrootd" inputOrder="runnumber" simulateSubmission="false" name="&runNumber;">
   <ResourceUsage>
      <StorageSpace>
         <MinStorage>20</MinStorage>
      </StorageSpace>
   </ResourceUsage>

   <Generator>
      <Location>./sums/</Location>
   </Generator>

   <command>
      starver &STAR_VER;
      #stardev

      cp $FILELIST &outPath;/lists_run11/R&runNumber;.lis

      setenv RUNLIST "&outPath;/lists_run11/R&runNumber;.lis"
      setenv OPTIONS `echo &STANA_OPTIONS; | sed 's/_/ /g'`
      setenv OPT_JETS `echo $OPTIONS | awk '{print index($0,"-j")}'`
      setenv COMMAND "./stana -f $RUNLIST $OPTIONS"

      if ($OPT_JETS == 0) ln -s &outPath;/jets_run11/jets_R&runNumber;.root
      ln -s &codePath;/.sl53_gcc432
      ln -s &codePath;/stana
      ls -al

      echo
      echo "outPath:        " &outPath;
      echo "codePath:       " &codePath;
      echo "runNumber:      " &runNumber;
      echo "STAR_VER:       " &STAR_VER;
      echo "STANA_OPTIONS:  " &STANA_OPTIONS;
      echo
      echo "STAR:           " $STAR
      echo "FILELIST:       " $FILELIST
      echo "RUNLIST:        " $RUNLIST
      echo "OPTIONS:        " $OPTIONS
      echo "OPT_JETS:       " $OPT_JETS
      echo "SCRATCH:        " $SCRATCH
      echo "pwd:            " `pwd`
      echo "COMMAND:        " $COMMAND

      # no spaces between arguments!
      #root4star -b -q stana.C\(n1;,\"$RUNLIST\"\)

      `$COMMAND`

      #ln -s &outPath;/jets_run11/jets_R&runNumber;.root
      #ls -al
      #./stana -f &outPath;/lists_run11/R&runNumber;.lis


      #@ nFile=0
      #while ( $nFile &lt; $INPUTFILECOUNT )
      #   eval set RUNLIST = '$INPUTFILE'$nFile 
      #   
      #   # put your script here, with RUNLIST as input file
      #   echo "RUNLIST:  " $RUNLIST 
      #   root4star -b -q stana.C\(n1;,\"$RUNLIST\"\)
      #   
      #   @ nFile++
      #end

   </command>

   <output fromScratch="R*hist.root"  toURL="file:&outPath;/hists_run11/"/>
   <output fromScratch="jets*.root"   toURL="file:&outPath;/jets_run11/"/>
   <output fromScratch="R*Wtree.root" toURL="file:&outPath;/wtree_run11/"/>
   <output fromScratch="*.ps"         toURL="file:&outPath;/ps_run11/"/>
   <stdout URL="file:&outPath;/log_run11/R&runNumber;.log"/>
   <stderr URL="file:&outPath;/log_run11/R&runNumber;.log"/>

   <SandBox>
       <Package>
          <File>file:&codePath;/.sl53_gcc432</File>
       </Package>
   </SandBox>

   <input URL="catalog:star.bnl.gov?filename~st_W,production=P11id,filetype=daq_reco_mudst,storage=hpss,runnumber~&runNumber;%" nFiles="all" />
   <!--<input URL="catalog:star.bnl.gov?filename~st_W,library=SL11id,filetype=daq_reco_mudst,storage=nfs,runnumber=&runNumber;" nFiles="all" />-->
   <!--<input URL="catalog:star.bnl.gov?filename~st_W,production=P09ig,filetype=daq_reco_mudst,runnumber=&runNumber;" nFiles="all" />-->
</job>
