<?xml version="1.0" encoding="utf-8" ?>
<job filesPerHour="1" maxFilesPerProcess="50" fileListSyntax="xrootd" inputOrder="runnumber" simulateSubmission="false" name="&RUNLIST_ID;">
   <ResourceUsage>
      <StorageSpace>
         <MinStorage>20</MinStorage>
      </StorageSpace>
   </ResourceUsage>

   <Generator>
      <Location>./sums/</Location>
   </Generator>

   <command>
      starver &STAR_VER;

      cp &codePath;/runlists/&RUNLIST_ID; &OUT_DIR;/lists_run11_cut15/&RUNLIST_ID;.lis

      setenv RUNLIST &OUT_DIR;/lists_run11_cut15/&RUNLIST_ID;.lis
      setenv OPTIONS `echo &STANA_OPTIONS; | sed 's/_/ /g'`
      setenv OPT_JETS `echo $OPTIONS | awk '{print index($0,"-j")}'`
      setenv COMMAND "./stana -f $RUNLIST $OPTIONS"

      if ($OPT_JETS == 0) ln -s &OUT_DIR;/jets_run11_cut15/jets_&RUNLIST_ID;.root
      cp -r &codePath;/.sl53_gcc432 .
      cp -r &codePath;/stana .
      ls -al

      echo
      echo "OUT_DIR:        " &OUT_DIR;
      echo "codePath:       " &codePath;
      echo "RUNLIST_ID:     " &RUNLIST_ID;
      echo "STAR_VER:       " &STAR_VER;
      echo "STANA_OPTIONS:  " &STANA_OPTIONS;
      echo
      echo "STAR:           " $STAR
      echo "FILELIST:       " $FILELIST
      echo "RUNLIST:        " $RUNLIST
      echo "OPTIONS:        " $OPTIONS
      echo "OPT_JETS:       " $OPT_JETS
      echo "SCRATCH:        " $SCRATCH
      echo "pwd:            " `pwd`
      echo "COMMAND:        " $COMMAND
      echo

      `$COMMAND`

      # Remove files and links
      if ($OPT_JETS == 0) rm jets_&RUNLIST_ID;.root
      chmod 664 *.hist.root jets_*.root *.wtree.root *.ps
      chmod 664 &OUT_DIR;/log_run11_cut15/&RUNLIST_ID;_&STANA_OPTIONS;.log
      touch     &OUT_DIR;/log_run11_cut15/&RUNLIST_ID;_&STANA_OPTIONS;.log
      rm -fr ./.sl53_gcc432
      rm -fr ./stana

   </command>

   <output fromScratch="*.hist.root"  toURL="file:&OUT_DIR;/data_run11_cut15/"/>
   <output fromScratch="jets_*.root"  toURL="file:&OUT_DIR;/jets_run11_cut15/"/>
   <output fromScratch="*.wtree.root" toURL="file:&OUT_DIR;/wtree_run11_cut15/"/>
   <output fromScratch="*.ps"         toURL="file:&OUT_DIR;/ps_run11/"/>
   <stdout URL="file:&OUT_DIR;/log_run11_cut15/&RUNLIST_ID;_&STANA_OPTIONS;.log"/>
   <stderr URL="file:&OUT_DIR;/log_run11_cut15/&RUNLIST_ID;_&STANA_OPTIONS;.log"/>

   <SandBox>
       <Package>
          <File>file:&codePath;/.sl53_gcc432</File>
       </Package>
   </SandBox>

   <!--<input URL="catalog:star.bnl.gov?filename~st_W,production=P11id,filetype=daq_reco_mudst,storage=hpss,runnumber~&RUNLIST_ID;%" nFiles="all" />-->
   <!--<input URL="catalog:star.bnl.gov?filename~st_W,library=SL11id,filetype=daq_reco_mudst,storage=nfs,runnumber=&RUNLIST_ID;" nFiles="all" />-->
   <!--<input URL="catalog:star.bnl.gov?filename~st_W,production=P09ig,filetype=daq_reco_mudst,runnumber=&RUNLIST_ID;" nFiles="all" />-->
</job>
